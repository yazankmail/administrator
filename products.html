<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª - Wusooly Admin</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap');
        :root { --primary: #5c6bc0; --bg: #F4F6F8; --dark: #1e293b; --text-light: #cbd5e1; }
        body { font-family: 'Cairo', sans-serif; background: var(--bg); margin: 0; display:flex; height: 100vh; overflow: hidden; }

        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© (Ù†ÙØ³ Ø§Ù„Ø£ÙˆÙ„Ù‰ Ø¨Ø§Ù„Ø¶Ø¨Ø·) */
        .sidebar { width: 260px; background: var(--dark); color: var(--text-light); display: flex; flex-direction: column; padding: 20px 0; }
        .logo { text-align: center; font-size: 24px; font-weight: bold; color: white; margin-bottom: 30px; border-bottom: 1px solid #334155; padding-bottom: 20px; }
        .nav-links { list-style: none; padding: 0 10px; flex: 1; }
        .nav-item { display: flex; align-items: center; gap: 10px; padding: 12px 15px; color: var(--text-light); text-decoration: none; border-radius: 8px; margin-bottom: 5px; transition: 0.3s; cursor: pointer; }
        .nav-item:hover, .nav-item.active { background: #334155; color: white; }
        .logout { padding: 0 20px; }
        .logout-btn { width: 100%; padding: 12px; background: #ffebee; color: #d32f2f; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }

        /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
        .main { flex: 1; padding: 30px; overflow-y: auto; display: none; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .add-btn { background: var(--primary); color: white; padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; }
        
        .table-box { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: right; padding: 15px; background: #f9fafb; color: #555; }
        td { padding: 15px; border-bottom: 1px solid #eee; vertical-align: middle; }
        .badge { padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: bold; }
        .badge.active { background: #d1fae5; color: #065f46; }
        .badge.out { background: #fee2e2; color: #991b1b; }
        .actions button { margin-left: 5px; cursor: pointer; border: none; background: none; font-size: 16px; }

        /* Ù…ÙˆØ¯Ø§Ù„ */
        .modal { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:none; justify-content:center; align-items:center; z-index: 1000; }
        .modal-content { background:white; padding:25px; border-radius:15px; width:400px; position:relative; }
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .input-group input, .input-group select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        .save-btn { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .close { position: absolute; top: 15px; left: 15px; cursor: pointer; font-size: 20px; }
        
        #loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 999; display: flex; justify-content: center; align-items: center; flex-direction: column; }
        .spinner { width: 40px; height: 40px; border: 4px solid #eee; border-top: 4px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 10px; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="loader"><div class="spinner"></div><p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...</p></div>

    <aside class="sidebar">
        <div class="logo">Wusooly Admin</div>
        <div class="nav-links">
            <a href="index.html" class="nav-item">ğŸ  Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©</a>
            <a href="products.html" class="nav-item active">ğŸ“¦ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</a>
            <a href="#" class="nav-item" onclick="alert('Ù‚Ø±ÙŠØ¨Ø§Ù‹')">ğŸ‘¥ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</a>
        </div>
        <div class="logout"><button class="logout-btn" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button></div>
    </aside>

    <main class="main" id="main-content">
        <div class="header">
            <h1>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h1>
            <button class="add-btn" onclick="openModal()">+ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</button>
        </div>

        <div class="table-box">
            <table>
                <thead><tr><th>Ø§Ù„Ù…Ù†ØªØ¬</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
                <tbody id="p-body"></tbody>
            </table>
        </div>
    </main>

    <div class="modal" id="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">âœ•</span>
            <h2 id="m-title">Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h2>
            <input type="hidden" id="eid">
            <div class="input-group"><label>Ø§Ù„Ø§Ø³Ù…</label><input type="text" id="name"></div>
            <div class="input-group"><label>Ø§Ù„Ø³Ø¹Ø±</label><input type="number" id="price"></div>
            <div class="input-group"><label>Ø§Ù„ÙƒÙ…ÙŠØ©</label><input type="number" id="stock"></div>
            <div class="input-group"><label>Ø§Ù„ÙØ¦Ø©</label><select id="cat"><option>Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª</option><option>Ù…Ù„Ø§Ø¨Ø³</option></select></div>
            <div class="input-group"><label>Ø§Ù„ØµÙˆØ±Ø©</label><input type="text" id="img" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©"></div>
            <button class="save-btn" onclick="save()">Ø­ÙØ¸</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, doc, deleteDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyBa0RwEcbVqWYAKeUFeZy2IDihaxUxtNKY", authDomain: "wusooly-1906b.firebaseapp.com", projectId: "wusooly-1906b", storageBucket: "wusooly-1906b.firebasestorage.app", messagingSenderId: "95836343161", appId: "1:95836343161:web:73ae3faaca406c0bf7fda8" };
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const ADMIN = "hmamda320@gmail.com";
        let allP = [];

        onAuthStateChanged(auth, (user) => {
            if (user && user.email === ADMIN) {
                document.getElementById('main-content').style.display = 'block';
                loadP();
            } else {
                window.location.href = "login.html";
            }
        });

        async function loadP() {
            const body = document.getElementById('p-body');
            body.innerHTML = '<tr><td colspan="5" style="text-align:center">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>';
            try {
                const snap = await getDocs(collection(db, "products"));
                allP = []; body.innerHTML = '';
                snap.forEach(d => {
                    const data = d.data(); data.id = d.id; allP.push(data);
                    const st = Number(data.stock);
                    const badge = st > 0 ? `<span class="badge active">Ù†Ø´Ø·</span>` : `<span class="badge out">Ù†ÙØ°Øª</span>`;
                    body.innerHTML += `<tr>
                        <td>${data.name}</td><td>$${data.price}</td><td>${st}</td><td>${badge}</td>
                        <td class="actions"><button onclick="edit('${data.id}')">âœï¸</button><button onclick="del('${data.id}')" style="color:red">ğŸ—‘ï¸</button></td>
                    </tr>`;
                });
                document.getElementById('loader').style.display = 'none';
            } catch(e) { console.log(e); }
        }

        window.openModal = () => { document.getElementById('modal').style.display='flex'; document.getElementById('m-title').innerText='Ø¬Ø¯ÙŠØ¯'; document.getElementById('eid').value=''; document.getElementById('name').value=''; document.getElementById('price').value=''; document.getElementById('stock').value=''; };
        window.closeModal = () => document.getElementById('modal').style.display='none';
        
        window.save = async () => {
            const id = document.getElementById('eid').value;
            const data = { name: document.getElementById('name').value, price: Number(document.getElementById('price').value), stock: Number(document.getElementById('stock').value), category: document.getElementById('cat').value, image: document.getElementById('img').value };
            const btn = document.querySelector('.save-btn'); btn.innerText='...';
            if(id) await updateDoc(doc(db,"products",id), data);
            else { data.createdAt = Date.now(); await addDoc(collection(db,"products"), data); }
            btn.innerText='Ø­ÙØ¸'; closeModal(); loadP();
        };

        window.edit = (id) => { const p = allP.find(x=>x.id===id); if(p){ openModal(); document.getElementById('m-title').innerText='ØªØ¹Ø¯ÙŠÙ„'; document.getElementById('eid').value=id; document.getElementById('name').value=p.name; document.getElementById('price').value=p.price; document.getElementById('stock').value=p.stock; } };
        window.del = async (id) => { if(confirm('Ø­Ø°ÙØŸ')) { await deleteDoc(doc(db,"products",id)); loadP(); } };
        window.logout = () => signOut(auth).then(() => window.location.href = "login.html");
    </script>
</body>
</html>
